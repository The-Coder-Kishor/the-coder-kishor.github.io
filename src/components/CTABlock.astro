---
import { SITE } from '@/config';
import { readFileSync } from 'fs';
import { join } from 'path';

const { enabled, filePath } = SITE.cta;

let ctaHTML = '';

if (enabled) {
  try {
    const fullPath = join(process.cwd(), filePath);
    const markdown = readFileSync(fullPath, 'utf-8');

    // Simple markdown to HTML conversion
    ctaHTML = markdown
      .replace(/^# (.+)$/gm, '<h1>$1</h1>')
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      .replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2">$1</a>')
      .replace(/^- (.+)$/gm, '<li>$1</li>')
      .replace(/(<li>.*?<\/li>\s*)+/gs, '<ul>$&</ul>')
      .replace(/\n\n+/g, '</p><p>')
      .replace(/^(?!<[hula])/gm, '<p>')
      .replace(/(?!>)$/gm, '</p>')
      .replace(/<p><\/p>/g, '')
      .replace(/<p>(<[hula])/g, '$1')
      .replace(/(<\/[hula][^>]*>)<\/p>/g, '$1');
  } catch (error) {
    console.error('Failed to load CTA markdown:', error);
  }
}
---

{
  enabled && ctaHTML && (
    <aside class="my-8 p-4 sm:p-5 rounded-xl bg-gradient-to-br from-primary/5 via-primary/10 to-primary/5 border border-primary/20 backdrop-blur-sm">
      <div class="cta-content prose prose-sm max-w-none dark:prose-invert" set:html={ctaHTML} />
    </aside>
  )
}

<style>
  .cta-content :global(h1) {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--color-foreground);
    margin-bottom: 0.5rem;
    margin-top: 0;
    line-height: 1.2;
  }

  @media (min-width: 640px) {
    .cta-content :global(h1) {
      font-size: 1.25rem;
    }
  }

  .cta-content :global(p) {
    font-size: 0.8125rem;
    color: var(--color-muted-foreground);
    line-height: 1.35;
    margin-bottom: 0.4rem;
  }

  @media (min-width: 640px) {
    .cta-content :global(p) {
      font-size: 0.875rem;
    }
  }

  .cta-content :global(ul) {
    margin-top: 0.5rem;
    margin-bottom: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    list-style: disc;
    padding-left: 1.25rem;
  }

  .cta-content :global(li) {
    font-size: 0.8125rem;
    color: var(--color-muted-foreground);
    line-height: 1.3;
  }

  @media (min-width: 640px) {
    .cta-content :global(li) {
      font-size: 0.875rem;
    }
  }

  .cta-content :global(a) {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem 1.25rem;
    border-radius: 0.5rem;
    background-color: var(--color-primary);
    color: var(--color-primary-foreground);
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    text-decoration: none;
    margin-top: 0.5rem;
    transition: all 0.3s;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  .cta-content :global(a:hover) {
    background-color: var(--color-primary);
    opacity: 0.9;
    transform: scale(1.05);
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  }

  .cta-content :global(strong) {
    color: var(--color-foreground);
    font-weight: 700;
  }
</style>
